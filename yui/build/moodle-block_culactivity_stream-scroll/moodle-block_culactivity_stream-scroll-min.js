YUI.add("moodle-block_culactivity_stream-scroll",function(c,t){M.block_culactivity_stream=M.block_culactivity_stream||{},M.block_culactivity_stream.scroll={limitnum:null,count:null,courseid:null,scroller:null,timer:null,init:function(t){var i,e,l;c.one(".pages")&&c.one(".pages").hide(),i=c.one(c.config.doc);try{e=c.one(".block_culactivity_stream .reload"),l=(l=c.one(".block_culactivity_stream").get("id")).replace("inst",""),c.one("#instance-"+l+"-header").append(e),e.setStyle("display","inline-block"),i.delegate("click",this.reloadblock,".block_culactivity_stream_reload",this)}catch(o){}i.delegate("click",this.removenotification,".block_culactivity_stream .removelink",this),this.scroller=c.one(".block_culactivity_stream .culactivity_stream"),this.scroller.on("scroll",this.filltobelowblock,this),this.limitnum=t.limitnum,this.count=t.count,this.courseid=t.courseid,this.returnurl=t.returnurl,this.instanceid=t.instanceid,this.timer=c.later(3e5,this,this.reloadnotifications,[],!0),this.filltobelowblock()},filltobelowblock:function(){var t,i,e=this.scroller.get("scrollHeight"),l=this.scroller.get("scrollTop"),o=this.scroller.get("clientHeight");e-(l+o)<10&&(this.timer.cancel(),t=0<(i=c.all(".block_culactivity_stream .notifications li").size())?c.all(".block_culactivity_stream .notifications li").item(i-1).get("id").split("_")[1]:0,this.addnotifications(i,t),this.timer=c.later(3e5,this,this.reloadnotifications,[],!0))},reloadblock:function(t){t.preventDefault(),this.reloadnotifications(t)},addnotifications:function(t,i){if(t<=this.count){this.scroller.detach("scroll"),c.one(".block_culactivity_stream_reload").setStyle("display","none"),c.one(".block_culactivity_stream_loading").setStyle("display","inline-block");var e={sesskey:M.cfg.sesskey,limitnum:this.limitnum,lastid:i,newer:!1,courseid:this.courseid,returnurl:this.returnurl,instanceid:this.instanceid};c.io(M.cfg.wwwroot+"/blocks/culactivity_stream/scroll_ajax.php",{method:"POST",data:window.build_querystring(e),context:this,on:{success:function(t,i){var e=c.JSON.parse(i.responseText);e.error?this.timer.cancel():c.one(".block_culactivity_stream .notifications").append(e.output),e.end||this.scroller.on("scroll",this.filltobelowblock,this),c.one(".block_culactivity_stream_loading").setStyle("display","none"),c.one(".block_culactivity_stream_reload").setStyle("display","inline-block")},failure:function(){c.one(".block_culactivity_stream_loading").setStyle("display","none"),c.one(".block_culactivity_stream_reload").setStyle("display","inline-block"),this.timer.cancel()}}})}},reloadnotifications:function(){var t,i=0;this.scroller.one("li")&&(i=this.scroller.one("li").get("id").split("_")[1]),c.one(".block_culactivity_stream_reload").setStyle("display","none"),c.one(".block_culactivity_stream_loading").setStyle("display","inline-block"),t={sesskey:M.cfg.sesskey,lastid:i,courseid:this.courseid,returnurl:this.returnurl,instanceid:this.instanceid},c.io(M.cfg.wwwroot+"/blocks/culactivity_stream/reload_ajax.php",{method:"POST",data:window.build_querystring(t),context:this,on:{success:function(t,i){var e=c.JSON.parse(i.responseText);e.error?this.timer.cancel():(c.one(".block_culactivity_stream .notifications").prepend(e.output),this.count=this.count+e.count),c.one(".block_culactivity_stream_loading").setStyle("display","none"),c.one(".block_culactivity_stream_reload").setStyle("display","inline-block")},failure:function(){c.one(".block_culactivity_stream_loading").setStyle("display","none"),c.one(".block_culactivity_stream_reload").setStyle("display","inline-block"),this.timer.cancel()}}})},removenotification:function(t){var i,e;t.preventDefault(),i=t.target.get("href").split("?")[1],e=c.QueryString.parse(i),c.io(M.cfg.wwwroot+"/blocks/culactivity_stream/remove_ajax.php",{method:"POST",data:i,context:this,on:{success:function(){c.one("#m_"+e.remove).next().remove(!0),c.one("#m_"+e.remove).remove(!0)}}})}}},"@VERSION@",{requires:["base","node","io","json-parse","dom-core","querystring","event-custom","moodle-core-dock"]});